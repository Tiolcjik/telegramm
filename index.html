<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UltraChat Live</title>
<style>
/* --- –û–±—â–∏–µ —Å—Ç–∏–ª–∏ --- */
body {
  margin: 0; font-family: 'Segoe UI', sans-serif;
  display: flex; height: 100vh; background: #0f1115; color: #eee;
  overflow: hidden;
}
/* --- –°–∞–π–¥–±–∞—Ä --- */
.sidebar {
  width: 280px; background: #1b1b1f; display: flex; flex-direction: column;
  border-right: 1px solid #2d2d33; box-shadow: 2px 0 10px rgba(0,0,0,0.4);
  transition: all 0.3s ease;
}
.logo {
  text-align: center; font-size: 26px; font-weight: bold;
  padding: 25px 0; border-bottom: 1px solid #2d2d33;
  letter-spacing: 1px; color: #2c7a2c;
}
.user-list {
  flex: 1; overflow-y: auto; padding: 15px; transition: all 0.3s ease;
}
.user {
  display: flex; align-items: center; gap: 14px; padding: 14px 18px;
  cursor: pointer; border-radius: 14px; transition: 0.2s;
  background: #1b1b1f; margin-bottom: 10px;
  box-shadow: 0 0 0 rgba(0,0,0,0);
}
.user:hover {background: #2a2a2e; box-shadow: 0 4px 10px rgba(0,0,0,0.5);}
.user.active {background: #2c2f33; box-shadow: 0 4px 12px rgba(0,0,0,0.7);}
.avatar {
  width: 50px; height: 50px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-weight: bold; font-size: 18px; background: #3a3a3a; color: #fff;
}
.online-indicator {
  width: 14px; height: 14px; border-radius: 50%; background: #2c7a2c;
  margin-left: auto;
}
.sidebar button {
  margin: 15px; padding: 12px; border: none; border-radius: 16px;
  cursor: pointer; background: #2a2a2e; color: #eee; font-weight: bold;
  transition: 0.2s;
}
.sidebar button:hover {background: #2c7a2c; color: #fff;}

/* --- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ --- */
.chat-container {
  flex: 1; display: flex; flex-direction: column; background: #121217;
  transition: all 0.3s ease;
}
.chat-header {
  padding: 18px; font-weight: bold; font-size: 20px; border-bottom: 1px solid #2d2d33;
  display: flex; justify-content: space-between; align-items: center;
  background: #1c1c20; box-shadow: 0 2px 6px rgba(0,0,0,0.5);
  color: #2c7a2c; transition: all 0.3s ease;
}
.chat-box {
  flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px;
  background: #121217; transition: all 0.3s ease;
}
.msg {
  padding: 14px 20px; border-radius: 22px; max-width: 70%; font-size: 15px;
  opacity: 0; transform: translateY(12px); transition: 0.3s ease, transform 0.3s ease;
  word-wrap: break-word;
}
.msg.show {opacity: 1; transform: translateY(0);}
.my-msg {align-self: flex-end; background: #2c7a2c; color: #fff; box-shadow: 0 3px 8px rgba(0,0,0,0.5);}
.their-msg {align-self: flex-start; background: #2a2a2e; color: #eee;
  display: flex; align-items: center; gap: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.5);}
.their-msg .avatar {width: 38px; height: 38px; font-size: 16px;}

/* --- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏ --- */
.typing {font-style: italic; color: #aaa; font-size: 13px; margin-left: 60px; animation: blink 1s infinite;}
@keyframes blink {0%,100%{opacity:0.2;}50%{opacity:1;}}

/* --- –ü–æ–ª–µ –≤–≤–æ–¥–∞ --- */
.chat-input-container {
  display: flex; padding: 14px; gap: 12px; border-top: 1px solid #2d2d33; background: #1c1c20;
}
.chat-input {
  flex: 1; padding: 14px; border-radius: 26px; border: 1px solid #2d2d33;
  background: #2a2a2e; color: #fff; outline: none; font-size: 15px;
  transition: all 0.2s ease;
}
.chat-input:focus {border-color: #2c7a2c;}
.send-btn {
  padding: 14px 22px; border: none; border-radius: 26px; background: #2c7a2c;
  color: #fff; cursor: pointer; font-weight: bold; transition: 0.2s;
}
.send-btn:hover {background: #1f5b1b; transform: scale(1.05);}

/* --- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ --- */
.auth-container, #profileModal {
  position: fixed; top:0; left:0; right:0; bottom:0;
  display: flex; justify-content: center; align-items: center;
  background: rgba(0,0,0,0.85); z-index: 1000;
}
.auth-box, .profileBox {
  background: #1c1c20; padding: 30px; border-radius: 18px;
  display: flex; flex-direction: column; gap: 15px; width: 320px;
  animation: modalFade 0.3s ease;
}
@keyframes modalFade {from{opacity:0; transform:scale(0.95);} to{opacity:1; transform:scale(1);}}

/* --- –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π --- */
.clear-btn {
  background: #b71c1c;
}
.clear-btn:hover {background: #7f0000; transform: scale(1.05);}
</style>
</head>
<body>

<div class="sidebar">
  <div class="logo">UltraChat</div>
  <div class="user-list" id="userList"></div>
  <button onclick="openProfile()">–ü—Ä–æ—Ñ–∏–ª—å</button>
  <button onclick="logout()">–í—ã–π—Ç–∏</button>
</div>

<div class="chat-container">
  <div class="chat-header" id="chatHeader">
    <span id="chatTitle">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
    <button id="backBtn" style="display:none;background:none;border:none;color:#2c7a2c;font-weight:bold;cursor:pointer;">‚Üê –ù–∞–∑–∞–¥</button>
  </div>
  <div class="chat-box" id="chatBox"></div>
  <div class="chat-input-container">
    <input class="chat-input" id="messageInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
    <button class="send-btn" onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </div>
</div>

<div class="auth-container" id="authContainer">
  <div class="auth-box">
    <input type="text" id="authUsername" placeholder="–õ–æ–≥–∏–Ω">
    <input type="password" id="authPassword" placeholder="–ü–∞—Ä–æ–ª—å">
    <button onclick="register()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
    <button onclick="login()">–í–æ–π—Ç–∏</button>
  </div>
</div>

<div id="profileModal">
  <div class="profileBox">
    <h3>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h3>
    <label>–ù–∏–∫–Ω–µ–π–º</label>
    <input type="text" id="profileName">
    <label>–°—Ç–∞—Ç—É—Å</label>
    <input type="text" id="profileStatus" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –≤ —Å–µ—Ç–∏">
    <label>–ê–≤–∞—Ç–∞—Ä</label>
    <select id="profileAvatarSelect">
      <option value="gradient">ASCII</option>
      <option value="meme1">üòÇ</option>
      <option value="meme2">üòé</option>
    </select>
    <button onclick="saveProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button onclick="closeProfile()">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<!-- –ó–≤—É–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
<audio id="notifSound" src="https://www.soundjay.com/buttons/sounds/button-3.mp3" preload="auto"></audio>

<script>
// --- –î–∞–Ω–Ω—ã–µ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ---
let currentUser=null, selectedUser=null;
let users=JSON.parse(localStorage.getItem("users"))||[];
let messages=JSON.parse(localStorage.getItem("messages"))||{};
let lastActivity=new Date().getTime();

const authContainer=document.getElementById("authContainer");
const chatBox=document.getElementById("chatBox");
const chatHeader=document.getElementById("chatHeader");
const userList=document.getElementById("userList");
const msgInput=document.getElementById("messageInput");
const backBtn=document.getElementById("backBtn");
const notifSound=document.getElementById("notifSound");

function saveData(){localStorage.setItem("users",JSON.stringify(users)); localStorage.setItem("messages",JSON.stringify(messages));}

// --- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ---
function register(){
  const username=document.getElementById("authUsername").value.trim();
  const password=document.getElementById("authPassword").value.trim();
  if(!username||!password){alert("–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å!"); return;}
  if(users.find(u=>u.username===username)){alert("–¢–∞–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!"); return;}
  users.push({username,password,avatarColor:"#4A4A4A",avatarType:"gradient",status:"–≤ —Å–µ—Ç–∏",online:true});
  saveData(); alert("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –í–æ–π–¥–∏—Ç–µ.");
}

// --- –í—Ö–æ–¥ ---
function login(){
  const username=document.getElementById("authUsername").value.trim();
  const password=document.getElementById("authPassword").value.trim();
  const user=users.find(u=>u.username===username && u.password===password);
  if(!user){alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å!"); return;}
  currentUser=username;
  user.online=true;
  user.status="–≤ —Å–µ—Ç–∏";
  saveData();
  authContainer.style.display="none";
  renderUsers();
}

// --- –í—ã—Ö–æ–¥ ---
function logout(){
  if(currentUser){
    const user = users.find(u=>u.username===currentUser);
    if(user){user.online=false; user.status="–Ω–µ –≤ —Å–µ—Ç–∏";}
    saveData();
  }
  currentUser=null; selectedUser=null; chatBox.innerHTML="";
  chatHeader.querySelector("#chatTitle").textContent="–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è";
  backBtn.style.display="none"; authContainer.style.display="flex";
  renderUsers();
}

// --- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ---
function renderUsers(){
  userList.innerHTML="";
  users.filter(u=>u.username!==currentUser).forEach(u=>{
    const div=document.createElement("div");
    div.className="user";
    let avatarContent=u.avatarType==="gradient"?u.username[0].toUpperCase():(u.avatarType==="meme1"?"üòÇ":"üòé");
    div.innerHTML=`<div class="avatar">${avatarContent}</div><div style="display:flex;flex-direction:column;"><span>${u.username}</span><small style="color:#2c7a2c;">${u.status||""}</small></div>`;
    const onlineDot=document.createElement("div"); onlineDot.className="online-indicator"; if(u.online) div.appendChild(onlineDot);
    div.onclick=()=>{selectUser(u.username);};
    if(u.username===selectedUser) div.classList.add("active");
    userList.appendChild(div);
  });

  // –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è Hells
  const existingBtn = document.getElementById("clearBtn");
  if(currentUser==="Hells" && !existingBtn){
    const btn = document.createElement("button");
    btn.id = "clearBtn";
    btn.className = "clear-btn";
    btn.textContent = "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π";
    btn.onclick = clearAllUsers;
    document.querySelector(".sidebar").appendChild(btn);
  }
  if(currentUser!=="Hells" && existingBtn){existingBtn.remove();}
}

// --- –í—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ---
function selectUser(username){
  selectedUser=username;
  chatHeader.querySelector("#chatTitle").textContent="–ß–∞—Ç —Å "+username;
  backBtn.style.display="inline";
  renderUsers();
  renderMessages();
}

backBtn.onclick=()=>{
  selectedUser=null;
  chatHeader.querySelector("#chatTitle").textContent="–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è";
  backBtn.style.display="none";
  chatBox.innerHTML="";
  renderUsers();
}

// --- –°–æ–æ–±—â–µ–Ω–∏—è ---
function renderMessages(){
  chatBox.innerHTML="";
  if(!selectedUser) return;
  const chatId=[currentUser,selectedUser].sort().join("_");
  const msgs=messages[chatId]||[];
  msgs.forEach((m,index)=>{
    const div=document.createElement("div");
    if(m.sender===currentUser){
      div.className="msg my-msg"; div.textContent=m.text;
      notifSound.play(); // –∑–≤—É–∫ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
    } else {
      div.className="msg their-msg";
      div.innerHTML=`<div class="avatar">${users.find(u=>u.username===m.sender)?.avatarType==="meme1"?"üòÇ":users.find(u=>u.username===m.sender)?.avatarType==="meme2"?"üòé":m.sender[0].toUpperCase()}</div><div>${m.text}</div>`;
      notifSound.play(); // –∑–≤—É–∫ –¥–ª—è –≤—Ö–æ–¥—è—â–µ–≥–æ
    }
    chatBox.appendChild(div);
    setTimeout(()=>{div.classList.add("show");}, index*50);
  });
  chatBox.scrollTop=chatBox.scrollHeight;
}

// --- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è ---
function sendMessage(){
  if(!selectedUser){alert("–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!"); return;}
  const text=msgInput.value.trim(); if(!text) return;
  const chatId=[currentUser,selectedUser].sort().join("_");
  if(!messages[chatId]) messages[chatId]=[];
  messages[chatId].push({sender:currentUser,text});
  saveData(); msgInput.value=""; renderMessages();
}

// --- –ü—Ä–æ—Ñ–∏–ª—å ---
function openProfile(){const user=users.find(u=>u.username===currentUser); if(!user) return; document.getElementById('profileName').value=user.username; document.getElementById('profileStatus').value=user.status||""; document.getElementById('profileAvatarSelect').value=user.avatarType||"gradient"; document.getElementById('profileModal').style.display="flex";}
function closeProfile(){document.getElementById('profileModal').style.display="none";}
function saveProfile(){
  const user=users.find(u=>u.username===currentUser); if(!user) return;
  const newName=document.getElementById('profileName').value.trim();
  const newStatus=document.getElementById('profileStatus').value.trim();
  const avatarType=document.getElementById('profileAvatarSelect').value;
  if(!newName){alert("–ù–∏–∫–Ω–µ–π–º –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º"); return;}
  if(newName!==currentUser && users.find(u=>u.username===newName)){alert("–¢–∞–∫–æ–π –Ω–∏–∫ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!"); return;}
  user.username=newName; user.status=newStatus; user.avatarType=avatarType;
  saveData(); currentUser=newName; renderUsers(); renderMessages(); closeProfile(); alert("–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω!");
}

// --- –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ---
function clearAllUsers(){
  if(!confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã?")) return;
  users=[]; messages={};
  localStorage.removeItem("users"); localStorage.removeItem("messages");
  currentUser=null; selectedUser=null; chatBox.innerHTML="";
  chatHeader.querySelector("#chatTitle").textContent="–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è";
  authContainer.style.display="flex";
  renderUsers();
  alert("–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–¥–∞–ª–µ–Ω—ã!");
}

// --- –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ ---
setInterval(()=>{
  if(currentUser){
    users.forEach(u=>{if(u.username!==currentUser && (!u.status||u.online)) u.status="–≤ —Å–µ—Ç–∏";});
    renderUsers();
  }
},3000);

// --- –ë–µ–∑–¥–µ–π—Å—Ç–≤–∏–µ ---
setInterval(()=>{
  if(currentUser){
    const now=new Date().getTime();
    if(now-lastActivity>15000){
      const user=users.find(u=>u.username===currentUser);
      if(user){user.status="–Ω–µ –≤ —Å–µ—Ç–∏"; user.online=false; saveData(); renderUsers();}
    }
  }
},3000);
</script>

</body>
</html>
